# 混合渲染策略：SPA 與 SSR 的最佳結合

在前端開發的世界中，我們經常在單頁應用（SPA）與服務端渲染（SSR）之間做選擇。SPA 提供了流暢的用戶體驗，而 SSR 則能提供更快的首屏加載速度和更好的 SEO。那麼，我們是否可以讓兩者的優點都得以體現呢？答案是肯定的，這就是混合渲染策略。

## 混合渲染策略是什麼？

混合渲染策略實際上是將 SSR 與 SPA 的技術結合在一起。首次訪問網站時，我們使用 SSR 來渲染頁面，這樣用戶可以快速看到頁面內容，同時也有利於 SEO。然後，我們將後續的路由管理交給前端，使其變成一個 SPA，這樣用戶在瀏覽網站時，就能獲得流暢的體驗。

## 如何實現混合渲染策略？

這裡我們以 Vue.js 為例，來看看如何實現混合渲染策略。Vue.js 提供了 `vue-server-renderer` 包來支持 SSR，我們首先需要安裝它：

```bash
npm install vue-server-renderer --save
```

然後，我們需要創建一個 `entry-server.js` 文件，這個文件將用於伺服器端的渲染：

```javascript
import { createApp } from './main'

export default context => {
  return new Promise((resolve, reject) => {
    const { app, router } = createApp()

    router.push(context.url)

    router.onReady(() => {
      resolve(app)
    }, reject)
  })
}
```

接著，我們需要創建一個 `entry-client.js` 文件，這個文件將用於客戶端的渲染：

```javascript
import { createApp } from './main'

const { app, router } = createApp()

router.onReady(() => {
  app.$mount('#app')
})
```

最後，我們需要在伺服器端使用 `vue-server-renderer` 渲染我們的應用：

```javascript
import { createRenderer } from 'vue-server-renderer'
import serverEntry from './entry-server'

const renderer = createRenderer()

app.get('*', (req, res) => {
  const context = { url: req.url }

  serverEntry(context).then(app => {
    renderer.renderToString(app, (err, html) => {
      if (err) {
        res.status(500).end('Internal Server Error')
        return
      }
      res.end(html)
    })
  })
})
```

如此，我們就實現了混合渲染策略，首次訪問時使用 SSR，後續的路由管理交給前端，變成一個 SPA。

## 結語

混合渲染策略在很多情況下，可以為我們提供更好的解決方案。它既能提供快速的首屏加載速度，又能提供流暢的用戶體驗。而且，由於首次訪問使用 SSR，也有利於 SEO。如果你正在考慮使用 SPA 還是 SSR，也許你可以考慮使用混合渲染策略。