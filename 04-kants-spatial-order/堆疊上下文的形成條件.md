# 深入理解堆疊上下文的形成條件

你是否曾經在調整 `z-index` 時,發現跟預期的行為不符？或者遇到無法調節元素層疊順序的情況？這些問題可能都與一個名為「堆疊上下文」的概念有關。在這篇文章中，我們將探討形成堆疊上下文的條件，以幫助你更好地理解和運用 `z-index`。

## 什麼是堆疊上下文？

堆疊上下文(Stacking Context) 是 HTML 元素的三維概念，決定了元素如何在網頁上與其他元素層疊。一個元素的堆疊上下文，影響其子元素的堆疊層級。

## 形成堆疊上下文的條件

以下情況會形成新的堆疊上下文：

1. 根元素（HTML）
2. `z-index` 值不為 'auto' 的定位元素（相對定位、絕對定位、固定定位）
3. `z-index` 值不為 'auto'，且 `display` 屬性為 'flex' 或 'grid' 的元素
4. `opacity` 屬性值小於 1 的元素
5. `transform`、`filter`、`perspective`、`clip-path`、`mask`、`mask-image`、`mask-border` 屬性值不為 'none' 的元素
6. `isolation` 屬性值為 'isolate' 的元素
7. `mix-blend-mode` 屬性值不為 'normal' 的元素
8. `will-change` 屬性值為 'transform'、'opacity'、'z-index' 的元素
9. 包含 `z-index` 屬性的 flex 項目（父元素的 `display` 屬性值為 'flex' 或 'inline-flex'）

## 程式碼範例

```html
<div style="position: relative; z-index: 1;">
  <!-- 這裡形成一個新的堆疊上下文 -->
  <div style="position: absolute; z-index: 2;"></div>
  <!-- 這裡的 z-index 為 2，但它在之前的堆疊上下文內，不會覆蓋下面的 div -->
</div>
<div style="position: relative; z-index: 1;"></div>
<!-- 這裡的 z-index 為 1，但它在新的堆疊上下文外，會覆蓋上面的 div -->
```

以上程式碼中，雖然第二個 div 的 z-index 為 2，比下面的 div 的 z-index 為 1 高，但它卻被下面的 div 覆蓋。這就是因為第二個 div 是在一個新的堆疊上下文內，而這個堆疊上下文的 z-index 只有 1。

## 結語

理解堆疊上下文及其形成條件，對於掌握 CSS 的層疊模型以及處理元素層疊順序的問題非常重要。希望這篇文章能幫助你在面對類似問題時，找到解決之道。